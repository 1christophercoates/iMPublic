<ng-container *ngIf="state$ | async as state">
    <ion-header [class.ion-no-border]="true">
      <ion-toolbar>
        <ion-buttons slot="start">
          <ion-menu-button></ion-menu-button>
        </ion-buttons>
        <ion-title>Moderation</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="refresh()">
            <ion-icon slot="icon-only" name="refresh"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
      <ion-progress-bar type="indeterminate" [class.hide]="state.loaded"></ion-progress-bar>
    </ion-header>

    <ion-content>
      <div class="im-cont" *ngIf="state.loaded">
        <div class="im-centered" *ngIf="state.posts.length < 1 && state.loaded">
          <div [style.display]="'grid'" [style.gap]="'0.1rem'">There are no activity posts.</div>
        </div>
  
        <im-block
          *ngFor="let post of state.posts; trackBy: trackPost"
        >
          <div body class="timeline-details">
            <ion-label lines="full">
          </ion-label>
          </div>

          <div body class="user-info">
            <div
              class="im-profile-pic medium"
              *ngIf="getUserAvatar(post) | imStorageUrl | async as url"
              [ngStyle]="{ 'background-image': 'url(' + url + ')' }"
            ></div>
            <div>
              <ion-list class="name-handle">
                <ion-label class="name-color"><b>{{ getUserFirstName(post) }} {{ getUserLastName(post) }}</b></ion-label>
                <ion-icon class="information-circle" (click)="viewProfile(getUserHandle(post))" name="information-circle"></ion-icon>
                <ion-label class="date" color="medium">{{ post.poi.dateSubmitted | date: 'longDate' }}</ion-label>
              </ion-list>
              <ion-label class="handle">@{{ getUserHandle(post) }}</ion-label>
            </div>
          </div>

          <div body class="timeline-details">
            <ion-label lines="full">
            </ion-label>
          </div>

          <div body class="timeline-details">
            <div id="{{post.id}}" class="timeline-info">{{ post.poi.enrollment.project.description }}</div>
          </div>
        
          <!-- Adds Swip-able carousel... still needs images to be sized + desktop version -->
          <div body class="activity-post-carousel">
            <ion-row class="ion-justify-content-center" *ngIf="post.poi.imagesFilePaths.length > 1">
              <ion-slides class="swiper-pagination" pager #slides [options]="{ scrollbar: false, loop: false }">
                <ion-slide *ngFor="let image of post.poi.imagesFilePaths">
                  <div class="scroll-left">
                    <ion-button (click)="slides.slidePrev()" color="dark" fill="clear" *ngIf="post.poi.imagesFilePaths.length > 1">
                      <ion-icon color="white" name="chevron-back-outline"></ion-icon>
                    </ion-button>
                  </div>
                  <img [src]="image | imStorageUrl | async"/>
                  <div class="scroll-right">
                    <ion-button (click)="slides.slideNext()" color="dark" fill="clear" *ngIf="post.poi.imagesFilePaths.length > 1">
                    <ion-icon color="white" name="chevron-forward-outline"></ion-icon>
                    </ion-button>
                  </div>
                </ion-slide>
              </ion-slides>
            </ion-row>

            <ion-row class="ion-justify-content-center" *ngIf="post.poi.imagesFilePaths.length === 1">
              <ion-slides class="swiper-pagination" #slides [options]="{ pager: false, scrollbar: false, loop: false }">
                <ion-slide *ngFor="let image of post.poi.imagesFilePaths">
                  <img [src]="image | imStorageUrl | async"/>
                </ion-slide>
              </ion-slides>
            </ion-row>
          </div>

          <div body class="timeline-details">
            <div class="timeline-detail-item" *ngIf="post.poi.imagesFilePaths.length === 1">
              <ion-buttons class="one"slot="start">
                <div *ngIf="!checkUserLiked(post)">
                  <ion-button #likeButton (click)="like(post.id, likeButton)">
                    <ion-icon class="black" name="heart-outline"></ion-icon>
                  </ion-button>
                </div>
                <div *ngIf="checkUserLiked(post)">
                  <ion-button #unlikeButton (click)="unlike(post.id, unlikeButton)">
                    <ion-icon class="black" name="heart"></ion-icon>
                  </ion-button>
                </div>
                <ion-button (click)="viewComments(post)">
                  <ion-icon class="black" name="chatbox-outline" expand="block"></ion-icon>
                </ion-button>
              </ion-buttons>
            </div>
            <div class="timeline-detail-item" *ngIf="post.poi.imagesFilePaths.length > 1">
              <ion-buttons class="multiple" slot="start">
                <div *ngIf="!checkUserLiked(post)">
                  <ion-button #likeButton (click)="like(post.id, likeButton)">
                    <ion-icon class="black" name="heart-outline"></ion-icon>
                  </ion-button>
                </div>
                <div *ngIf="checkUserLiked(post)">
                  <ion-button #unlikeButton (click)="unlike(post.id, unlikeButton)">
                    <ion-icon class="black" name="heart"></ion-icon>
                  </ion-button>
                </div>
                <ion-button (click)="viewComments(post)">
                  <ion-icon class="black" name="chatbox-outline" expand="block"></ion-icon>
                </ion-button>
              </ion-buttons>
            </div>
      
            <div class="timeline-item-details">
              <div *ngIf="!checkUserLiked(post)"> 
                <ion-label class="timeline-detail-item" color="dark">
                  <p>Liked by <b>{{post.likeCount}} others </b></p>
                </ion-label>
              </div>
              <div *ngIf="checkUserLiked(post)"> 
                <ion-label class="timeline-detail-item" color="dark">
                  <p>Liked by <b>you</b> and <b>{{post.likeCount - 1}} others </b></p>
                </ion-label>
              </div>
      
              <ion-button slot="start" class="comment-dropdown" (click)="viewComments(post)" fill="clear" >
                <p>Comments</p>
                <ion-icon name="chevron-down" fill="clear"></ion-icon>
              </ion-button>
            </div>
          </div>
        </im-block>

        <ion-infinite-scroll threshold="100px" (ionInfinite)="loadMore($event)">
          <ion-infinite-scroll-content
            loadingSpinner="bubbles"
            loadingText="Loading more POIs..."
          ></ion-infinite-scroll-content>
        </ion-infinite-scroll>
      </div>
    </ion-content>
  </ng-container>